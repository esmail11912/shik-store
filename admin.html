<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>ادمین — شیک استور</title>
<style>
  body{margin:0;background:#0b0c10;color:#e6e8eb;font:15px/1.7 system-ui,"Vazirmatn",sans-serif}
  .wrap{max-width:1000px;margin:0 auto;padding:16px}
  input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #1e2027;background:#0f1116;color:#e6e8eb}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .card{border:1px solid #1e2027;border-radius:14px;padding:12px;background:#111217;margin:10px 0}
  button{border:1px solid #1e2027;background:#151924;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer}
  button.primary{background:linear-gradient(135deg,#7c5cff,#5ac8fa);border:0}
  table{width:100%;border-collapse:collapse} th,td{border-bottom:1px solid #1e2027;padding:8px;text-align:start}
</style>
</head>
<body>
<div class="wrap">
  <div class="row" style="justify-content:space-between"><h2>ادمین — شیک استور</h2><a href="/" style="color:#9aa0aa;text-decoration:none">فروشگاه</a></div>
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div class="row"><input id="pass" type="password" placeholder="رمز ادمین"><button id="login" class="primary">ورود</button></div>
      <div class="row"><button id="refresh">بروزرسانی</button><button id="publish" class="primary">انتشار</button></div>
    </div>
    <small style="color:#9aa0aa">انتشار، فایل products.json را در GitHub commit می‌کند.</small>
  </div>

  <div class="card">
    <div class="row">
      <input id="id" placeholder="id"> <input id="sku" placeholder="SKU">
      <select id="cat"><option value="ebook">ای‌بوک</option><option value="software">نرم‌افزار</option><option value="art">هنر</option></select>
      <input id="title_fa" placeholder="عنوان (FA)"><input id="title_en" placeholder="Title (EN)">
      <input id="desc_fa" placeholder="توضیح (FA)"><input id="desc_en" placeholder="Description (EN)">
      <input id="price" type="number" step="0.01" value="10" placeholder="قیمت (USDT)"><input id="image" placeholder="Image URL">
    </div>
    <div class="row" style="margin-top:8px"><button class="primary" id="save">ذخیره/افزودن</button><button id="reset">ریست</button></div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between"><h3>محصولات</h3><span style="color:#9aa0aa">ویرایش، حذف، انتشار</span></div>
    <table><thead><tr><th>ID</th><th>عنوان</th><th>قیمت</th><th>دسته</th><th>SKU</th><th></th></tr></thead><tbody id="tbody"></tbody></table>
  </div>
</div>

<script>
const $=s=>document.querySelector(s); let rows=[]; let token=null;
function render(){ $('#tbody').innerHTML = rows.map(r=>`<tr><td>${r.id}</td><td>${r.title?.fa||''}</td><td>${r.price}</td><td>${r.cat}</td><td>${r.sku||''}</td><td><button onclick="edit('${r.id}')">ویرایش</button><button onclick="rem('${r.id}')">حذف</button></td></tr>`).join(''); }
function read(){ return { id:$('#id').value.trim(), sku:$('#sku').value.trim(), cat:$('#cat').value, title:{fa:$('#title_fa').value.trim(),en:$('#title_en').value.trim()}, desc:{fa:$('#desc_fa').value.trim(),en:$('#desc_en').value.trim()}, price:parseFloat($('#price').value||'0'), image:$('#image').value.trim()||null }; }
function saveRow(){ const r=read(); if(!r.id||!r.title.fa||!r.title.en) return alert('id و عنوان‌ها لازم است'); const i=rows.findIndex(x=>x.id===r.id); if(i>=0) rows[i]=r; else rows.push(r); render(); }
function edit(id){ const r=rows.find(x=>x.id===id); if(!r) return; $('#id').value=r.id; $('#sku').value=r.sku||''; $('#cat').value=r.cat; $('#title_fa').value=r.title.fa; $('#title_en').value=r.title.en; $('#desc_fa').value=r.desc.fa||''; $('#desc_en').value=r.desc.en||''; $('#price').value=r.price; $('#image').value=r.image||''; }
function rem(id){ if(!confirm('حذف شود؟')) return; rows = rows.filter(x=>x.id!==id); render(); }
async function fetchRows(){ const r=await fetch('/api/products'); const d=await r.json(); rows = d.products||[]; render(); }
async function publish(){ if(!token){token = prompt('رمز ادمین؟'); if(!token) return;} const res=await fetch('/api/products',{method:'POST',headers:{'Content-Type':'application/json','x-admin-key':token},body:JSON.stringify({products:rows})}); const d=await res.json(); if(res.ok) alert('منتشر شد'); else alert('خطا: '+(d.error||res.status)); }
$('#login').onclick=()=>{ token = $('#pass').value.trim()||null; alert(token?'وارد شدی.':'رمز لازم است'); };
$('#refresh').onclick=fetchRows; $('#publish').onclick=publish; $('#save').onclick=saveRow; $('#reset').onclick=()=>['id','sku','title_fa','title_en','desc_fa','desc_en','price','image'].forEach(x=>$('#'+x).value=''); fetchRows();
</script>
</body></html>
