<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>پنل ادمین — فروشگاه HTML</title>
  <style>
    :root{ --bg:#0b0c10; --card:#111217; --text:#e6e8eb; --muted:#9aa0aa; --border:#1e2027; --brand:#7c5cff; --shadow:0 10px 30px rgba(0,0,0,.2) }
    body{ margin:0; background:var(--bg); color:var(--text); font:15px/1.6 system-ui, -apple-system, Segoe UI, Roboto, "Vazirmatn", sans-serif }
    .container{ max-width:1000px; margin:0 auto; padding:18px }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px; box-shadow:var(--shadow); margin:10px 0 }
    .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
    .grid{ display:grid; grid-template-columns: repeat(12,1fr); gap:10px }
    .col-3{ grid-column: span 3 } .col-4{ grid-column: span 4 } .col-6{ grid-column: span 6 } .col-12{ grid-column: span 12 }
    @media (max-width: 820px){ .col-6,.col-4,.col-3{ grid-column: span 12 } }
    input,textarea,select{ width:100%; padding:10px; border-radius:10px; background:#0f1116; border:1px solid var(--border); color:var(--text) }
    label{ font-size:12px; color:var(--muted) }
    button{ border:1px solid var(--border); background:#141824; color:var(--text); padding:10px 14px; border-radius:10px; cursor:pointer }
    button.primary{ background:linear-gradient(135deg,#7c5cff,#5ac8fa); color:#fff; border-color:transparent }
    table{ width:100%; border-collapse: collapse; font-size:14px }
    th,td{ border-bottom:1px solid var(--border); padding:8px; text-align: start }
    .muted{ color:var(--muted) }
    .badge{ background:#1b1f2a; border:1px solid var(--border); padding:2px 8px; border-radius:999px; font-size:12px }
    .danger{ color:#ef4444 }
    .ok{ color:#22c55e }
  </style>
</head>
<body>
  <div class="container">
    <div class="row" style="justify-content: space-between;">
      <h2>پنل ادمین — فروشگاه HTML</h2>
      <div class="row">
        <a class="badge" href="index.html">مشاهده فروشگاه</a>
      </div>
    </div>

    <!-- Import / Export -->
    <div class="card">
      <div class="row" style="justify-content: space-between;">
        <div class="row">
          <button id="btnExport" class="primary">خروجی گرفتن (products.json)</button>
          <label class="muted">یک فایل JSON از محصولات فعلی دانلود می‌شود. آن را کنار index.html آپلود کن.</label>
        </div>
        <div class="row">
          <input type="file" id="importFile" accept="application/json" />
          <button id="btnImport">وارد کردن</button>
        </div>
      </div>
    </div>

    <!-- Editor -->
    <div class="card">
      <h3 style="margin:6px 0">افزودن / ویرایش محصول</h3>
      <div class="grid">
        <div class="col-4">
          <label>شناسه (id)</label>
          <input id="id" placeholder="مثال: p100" />
        </div>
        <div class="col-4">
          <label>SKU</label>
          <input id="sku" placeholder="مثال: E-001" />
        </div>
        <div class="col-4">
          <label>دسته</label>
          <select id="cat">
            <option value="ebook">ای‌بوک</option>
            <option value="software">نرم‌افزار</option>
            <option value="art">هنر</option>
          </select>
        </div>

        <div class="col-6">
          <label>عنوان (FA)</label>
          <input id="title_fa" />
        </div>
        <div class="col-6">
          <label>Title (EN)</label>
          <input id="title_en" />
        </div>
        <div class="col-6">
          <label>توضیح (FA)</label>
          <input id="desc_fa" />
        </div>
        <div class="col-6">
          <label>Description (EN)</label>
          <input id="desc_en" />
        </div>
        <div class="col-4">
          <label>قیمت (USDT)</label>
          <input id="price" type="number" step="0.01" value="10" />
        </div>
        <div class="col-8">
          <label>تصویر (URL اختیاری)</label>
          <input id="image" placeholder="https://..." />
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="primary" id="save">ذخیره / افزودن</button>
        <button id="reset">خالی کردن فرم</button>
      </div>
    </div>

    <!-- List -->
    <div class="card">
      <div class="row" style="justify-content: space-between;">
        <h3 style="margin:6px 0">فهرست محصولات</h3>
        <span class="muted">روی ویرایش کلیک کن تا اطلاعات وارد فرم شود</span>
      </div>
      <table>
        <thead>
          <tr>
            <th>ID</th><th>عنوان</th><th>قیمت</th><th>دسته</th><th>SKU</th><th></th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <p class="muted">نکته: این پنل فقط HTML/JS است — داده‌ها را در مرورگر شما نگه می‌دارد و برای انتشار باید JSON خروجی را کنار <code>index.html</code> آپلود کنید.</p>
  </div>

  <script>
    const $ = s=>document.querySelector(s);
    let rows = JSON.parse(localStorage.getItem('ADMIN_PRODUCTS')||'[]');

    function render(){
      const tbody = $('#tbody');
      tbody.innerHTML = rows.map(r => \`
        <tr>
          <td>\${r.id}</td>
          <td>\${r.title.fa}</td>
          <td>\${r.price}</td>
          <td>\${r.cat}</td>
          <td>\${r.sku||''}</td>
          <td>
            <button onclick="edit('\${r.id}')">ویرایش</button>
            <button onclick="rem('\${r.id}')" class="danger">حذف</button>
          </td>
        </tr>\`
      ).join('');
      localStorage.setItem('ADMIN_PRODUCTS', JSON.stringify(rows));
    }

    function resetForm(){
      ['id','sku','title_fa','title_en','desc_fa','desc_en','price','image'].forEach(x=> $('#'+x).value='');
      $('#cat').value='ebook';
    }

    function readForm(){
      return {
        id: $('#id').value.trim(),
        sku: $('#sku').value.trim(),
        cat: $('#cat').value,
        title: { fa: $('#title_fa').value.trim(), en: $('#title_en').value.trim() },
        desc: { fa: $('#desc_fa').value.trim(), en: $('#desc_en').value.trim() },
        price: parseFloat($('#price').value||'0'),
        image: $('#image').value.trim() || null
      }
    }

    function save(){
      const r = readForm();
      if(!r.id || !r.title.fa || !r.title.en){ alert('id و عنوان‌ها الزامی است.'); return; }
      const i = rows.findIndex(x=>x.id===r.id);
      if(i>=0) rows[i]=r; else rows.push(r);
      render(); resetForm();
    }

    function edit(id){
      const r = rows.find(x=>x.id===id); if(!r) return;
      $('#id').value = r.id; $('#sku').value=r.sku||''; $('#cat').value=r.cat;
      $('#title_fa').value=r.title.fa; $('#title_en').value=r.title.en;
      $('#desc_fa').value=r.desc.fa||''; $('#desc_en').value=r.desc.en||'';
      $('#price').value=r.price; $('#image').value=r.image||'';
    }

    function rem(id){
      if(!confirm('حذف شود؟')) return;
      rows = rows.filter(x=>x.id!==id); render();
    }

    function exportJson(){
      const data = { products: rows };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type:'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'products.json';
      a.click();
      URL.revokeObjectURL(a.href);
    }

    async function importJson(file){
      const txt = await file.text();
      const data = JSON.parse(txt);
      if(!Array.isArray(data.products)){ alert('ساختار فایل نامعتبر است.'); return; }
      rows = data.products;
      render();
    }

    // hooks
    $('#save').onclick = save;
    $('#reset').onclick = resetForm;
    $('#btnExport').onclick = exportJson;
    $('#btnImport').onclick = () => { const f = document.getElementById('importFile').files[0]; if(!f) return alert('فایل را انتخاب کنید'); importJson(f) };

    // boot
    render();
  </script>
</body>
</html>
